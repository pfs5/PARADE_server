<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1">

    <title>ParADE</title>
    
    <style>
        body {
            background-color: black;
            color: lightgray;
            font-family: sans-serif;
        }

		.overlay{
    		opacity:0.8;
    		position:fixed;
    		width:100%;
    		height:100%;
    		top:0px;
    		left:0px;
    		z-index:1000;
		}
    </style>
</head>
<body>
    <p id="Label">Connecting...</p>
	<div id="element">No input.</div>
	<div id="output"></div>
	<div class="overlay" id="back"></div>
	
    <!--<script src="js/gyro.min.js"></script>-->
    <script src="js/gyro.edited.js"></script>
    <script src="js/connection.js"></script>
	<script src="js/hammer.min.js"></script>
    <script type="text/javascript">
        
        var CON_ADDRESS = window.location.hostname;
        var CON_PORT = '9090';
        var SENSOR_FREQ = 50;	//50
        var TIMEOUT = null;		//30000;
        
        var LABEL = document.getElementById('Label');
        
        con.init(CON_ADDRESS, CON_PORT);
        
        con.onOpenCallback = function() 
        {
            LABEL.innerHTML = 'Connected successfully.';
            
            gyro.frequency = SENSOR_FREQ;
            gyro.calibrate();
            gyro.startTracking(function(o) {
                con.sendMeasurements(o);
                
                // Debug
                var e = document.getElementById('output');
                e.innerHTML = "<p> x = " + o.x + "</p>" +
                          			"<p> y = " + o.y + "</p>" +
                          			"<p> z = " + o.z + "</p>" +
                          			"<p> alpha = " + o.alpha + "</p>" +
                          			"<p> beta = " + o.beta + "</p>" +
                          			"<p> gamma = " + o.gamma + "</p>";
            });
        };
        
        con.connect();
        
        if(TIMEOUT != null)
        {
            setTimeout(function () 
            {
                LABEL.innerHTML = 'Timeout!';

                con.disconnect();

            }, TIMEOUT);
        }
        
//        gyro.startTracking(function(o) {
//			var b = document.getElementById('example'),
//				f = document.getElementById('features');
//            
//			f.innerHTML = gyro.getFeatures();
//			b.innerHTML = "<p> x = " + o.x + "</p>" +
//                          "<p> y = " + o.y + "</p>" +
//                          "<p> z = " + o.z + "</p>" +
//                          "<p> alpha = " + o.alpha + "</p>" +
//                          "<p> beta = " + o.beta + "</p>" +
//                          "<p> gamma = " + o.gamma + "</p>";
//            
//            con.sendMeasurements(o);
//		});
        
    </script>

	<script type="text/javascript">
	// Touch gestures
	var myElement = document.getElementById('back');
	var output = document.getElementById('element');
	var mc = new Hammer(myElement);
	
	var pinchActive = false;
	
	// Enable events
	mc.get('pinch').set({enable: true});	

	// Events	
	mc.on("pinchstart pinchin", function(event) {
		output.innerHTML = event.type + ' gesture detected.';
		con.setPinchStart(-1);
	});

	mc.on("pinchstart pinchout", function(event) {
		output.innerHTML = event.type + ' gesture detected.';
		con.setPinchStart(1);
	});

	mc.on("pinchend", function(event) {
		output.innerHTML = event.type + ' gesture detected.';
		con.setPinchEnd();
	});
	
	mc.on("tap", function(event) {
		output.innerHTML = event.type + ' gesture detected.';
		con.sendGesture(event.type);
	});
	
	mc.on("doubletap", function(event) {
		output.innerHTML = event.type + ' gesture detected.';
		gyro.calibrate();
	});
	
	</script>
</body>
</html>
